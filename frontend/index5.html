<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no,viewport-fit=cover"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="./src/index.css">
    <link rel="stylesheet" href="./src/chat.css">
  </head>
  <body>
    <div class='whole page-chats'>
      <div class="chat tabs-tab active">
        <div class='sidebar-header topbar'>
          topbar
        </div>
        <div class="bubbles">
          <div class='scrollable scrollable-y'>
            <div class='bubbles-inner'>
              <div class="bubbles-date-group">
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
				<div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
				<div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
				<div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
				<div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
                <div>dsasadsda</div>
              </div>
            </div>
          </div>
        </div>
          <div class='chat-input'>
            <div class='chat-input-container'>
              <textarea id="input" style="position:absolute;bottom:0;left:0;right:0;" tabindex="-1"></textarea>
            </div>
          </div>
        </div>
        </div>
  </body>
  <script>

// Disable scroll mobile
function preventDefault(e) {
	e.preventDefault();
}

var supportsPassive = false;
try {
	window.addEventListener("test", null, Object.defineProperty({}, 'passive', {
		get: function () { supportsPassive = true; } 
	}));
} catch(e) {}

var wheelOpt = supportsPassive ? { passive: false } : false;

document.querySelector('.topbar').addEventListener('touchmove', preventDefault, wheelOpt);
document.querySelector('.chat-input').addEventListener('touchmove', preventDefault, wheelOpt);

document.querySelector('.bubbles-inner').addEventListener('touchmove', (e) => {
	if (focused) {
		e.preventDefault();
	}
}, wheelOpt);

// Fix auto scroll on focus
document.getElementById("input").addEventListener("mouseup", (e) => {
	document.getElementById("input").blur();
	document.getElementById("input").focus({ preventScroll: true });
	setTimeout( () => {focused = false}, '900');
});

// iOS detect
function isiOS() {
	return [
	  'iPad Simulator',
	  'iPhone Simulator',
	  'iPod Simulator',
	  'iPad',
	  'iPhone',
	  'iPod'
	].includes(navigator.platform)
	// iPad on iOS 13 detection
	|| (navigator.userAgent.includes("Mac") && "ontouchend" in document)
}

if (isiOS()) {
	document.documentElement.classList.add('is-ios');
}

let setViewportVH = false; // HasFocus = false
let focused = false;

// Auto resize height
document.addEventListener('DOMContentLoaded', async() => {
	const w = window.visualViewport || window; // Handle iOS keyboard
	let lastVH;
	const setVH = () => {
		let vh = (setViewportVH ? w.height || w.innerHeight : window.innerHeight) * 0.01;
		vh = +vh.toFixed(2);
		if(lastVH === vh) {
			return;
		}

		lastVH = vh;

		document.documentElement.style.setProperty('--vh', `${vh}px`);

    	//window.scroll(0,0)
		//console.log('setVH', vh, setViewportVH ? w : window);
	};

	window.addEventListener('resize', setVH);
	setVH();

  	// Focused input
	const toggleResizeMode = () => {
		setViewportVH = true;
		setVH();
  
    	if(w !== window) {
    		window.removeEventListener('resize', setVH);
    		w.addEventListener('resize', setVH);
    	}
	};

	document.getElementById("input").addEventListener('focus', () => {
		focused = true;
   		toggleResizeMode();
  	});
});

  </script>
</html>
